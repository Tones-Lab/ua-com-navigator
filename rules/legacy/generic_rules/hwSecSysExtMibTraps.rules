####################
# Monolith rules file created by Eirteic oid-to-rules v0.95
####################
# enterprise oid: 1.3.6.1.4.1.2011.6.122.29.0.2
####################

my ( %oid, %iid, %val );

$oid{hwSecDeviceSerialNumber}   = '1.3.6.1.4.1.2011.6.122.29.0.1.1';
$oid{hwSecModuleName}           = '1.3.6.1.4.1.2011.6.122.29.0.1.2';
$oid{hwSecUsage}                = '1.3.6.1.4.1.2011.6.122.29.0.1.3';
$oid{hwSecThreshold}            = '1.3.6.1.4.1.2011.6.122.29.0.1.4';
$oid{hwSecSysExtFileOperResult} = '1.3.6.1.4.1.2011.6.122.29.1.2.2.1.1';

while ( my ( $k, $v ) = each(%$vars) ) {

    # The first two exact keys should always be there:
    if ( $k eq '1.3.6.1.2.1.1.3.0' ) {
        $val{'sysUpTime'} = $v;
    }
    elsif ( $k eq '1.3.6.1.6.3.1.1.4.1.0' ) {
        $val{'snmpTrapOid'} = $v;
    }
    elsif ( $k =~ /^\Q$oid{hwSecDeviceSerialNumber}\E(\.|$)(.*)/ ) {
        $iid{hwSecDeviceSerialNumber} = $2;
        $val{hwSecDeviceSerialNumber} = $v;
    }
    elsif ( $k =~ /^\Q$oid{hwSecModuleName}\E(\.|$)(.*)/ ) {
        $iid{hwSecModuleName} = $2;
        $val{hwSecModuleName} = $v;
    }
    elsif ( $k =~ /^\Q$oid{hwSecSysExtFileOperResult}\E(\.|$)(.*)/ ) {
        $iid{hwSecSysExtFileOperResult} = $2;
        $val{hwSecSysExtFileOperResult} = $v;
    }
    elsif ( $k =~ /^\Q$oid{hwSecThreshold}\E(\.|$)(.*)/ ) {
        $iid{hwSecThreshold} = $2;
        $val{hwSecThreshold} = $v;
    }
    elsif ( $k =~ /^\Q$oid{hwSecUsage}\E(\.|$)(.*)/ ) {
        $iid{hwSecUsage} = $2;
        $val{hwSecUsage} = $v;
    }
}

# This should always be set
$Event->{'Node'} = $node || "$ip";

# These should be set to suitable values per-trap
$Event->{'AlarmType'}     = 14400;    # > 30 = seconds to auto-clear
#$Event->{'Summary'}       = "";
#$Event->{'AlarmGroup'}    = "";
#$Event->{'SubAlarmGroup'} = "";
$Event->{'Severity'}      = 1;    # 0 = minor, 5 = major, 1 = unknown
#$Event->{'AlarmKey'}      = ""; # unique for de-dupe. Include $ip and $summary?

# For each OBJECT, you can use $oid{OBJECT}, $iid{OBJECT}, or $val{OBJECT}

if (0) {    # dummy
}
elsif ( $specific == 1 ) {    # hwSecSysRebootNotify

    # ============
    # DESCRIPTION:
    #  "A trap signifies a reboot operation will be executed immediately."
    # ============

    # OBJECTS: hwSecDeviceSerialNumber

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecSysRebootNotify";
    $Event->{'AlarmGroup'}    = "hwSecSysRebootNotify";
    #$Event->{'SubAlarmGroup'} = "hwSecSysRebootNotify";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecSysRebootNotify alarm.";
}
elsif ( $specific == 2 ) {    # hwSecSysConfigChgNotify

    # ============
    # DESCRIPTION:
    #  "A trap signifies a change on configuration file has been made and saved."
    # ============

    # OBJECTS: hwSecDeviceSerialNumber

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecSysConfigChgNotify";
    $Event->{'AlarmGroup'}    = "hwSecSysConfigChgNotify";
    #$Event->{'SubAlarmGroup'} = "hwSecSysConfigChgNotify";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecSysConfigChgNotify alarm.";
}
elsif ( $specific == 3 ) {    # hwSecServStatusTrunUp

    # ============
    # DESCRIPTION:
    #  " A trap signifies a Service module status has turned up."
    # ============

    # OBJECTS: hwSecDeviceSerialNumber hwSecModuleName

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecServStatusTrunUp";
    $Event->{'AlarmGroup'}    = "hwSecServStatusTrunUp";
    #$Event->{'SubAlarmGroup'} = "hwSecServStatusTrunUp";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecServStatusTrunUp alarm.";
}
elsif ( $specific == 4 ) {    # hwSecServStatusTurnDown

    # ============
    # DESCRIPTION:
    #  " A trap signifies a Service module status has turned down."
    # ============

    # OBJECTS: hwSecDeviceSerialNumber hwSecModuleName

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecServStatusTurnDown";
    $Event->{'AlarmGroup'}    = "hwSecServStatusTurnDown";
    #$Event->{'SubAlarmGroup'} = "hwSecServStatusTurnDown";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecServStatusTurnDown alarm.";
}
elsif ( $specific == 5 ) {    # hwSecCpuUsageThresExceed

    # ============
    # DESCRIPTION:
    #  " A trap signifies a Service module status has turned down."
    # ============

    # OBJECTS: hwSecDeviceSerialNumber hwSecUsage hwSecThreshold

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecCpuUsageThresExceed";
    $Event->{'AlarmGroup'}    = "hwSecCpuUsageThresExceed";
    #$Event->{'SubAlarmGroup'} = "hwSecCpuUsageThresExceed";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecCpuUsageThresExceed alarm.";
}
elsif ( $specific == 6 ) {    # hwSecRamUsageThresExceed

    # ============
    # DESCRIPTION:
    #  " A trap signifies a Service module status has turned down."
    # ============

    # OBJECTS: hwSecDeviceSerialNumber hwSecUsage hwSecThreshold

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecRamUsageThresExceed";
    $Event->{'AlarmGroup'}    = "hwSecRamUsageThresExceed";
    #$Event->{'SubAlarmGroup'} = "hwSecRamUsageThresExceed";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecRamUsageThresExceed alarm.";
}
elsif ( $specific == 7 ) {    # hwSecDiskUsageThresExceed

    # ============
    # DESCRIPTION:
    #  " A trap signifies a Service module status has turned down."
    # ============

    # OBJECTS: hwSecDeviceSerialNumber hwSecUsage hwSecThreshold

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecDiskUsageThresExceed";
    $Event->{'AlarmGroup'}    = "hwSecDiskUsageThresExceed";
    #$Event->{'SubAlarmGroup'} = "hwSecDiskUsageThresExceed";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecDiskUsageThresExceed alarm.";
}
elsif ( $specific == 8 ) {    # hwSecFileOperNotification

    # ============
    # DESCRIPTION:
    #  "."
    # ============

    # OBJECTS: hwSecSysExtFileOperResult

    #$Event->{'AlarmType'}     = 14400;
    $Event->{'Summary'}       = "hwSecFileOperNotification";
    $Event->{'AlarmGroup'}    = "hwSecFileOperNotification";
    #$Event->{'SubAlarmGroup'} = "hwSecFileOperNotification";
    $Event->{'Severity'}      = 1;
    $Event->{'AlarmKey'}      = "$ip: hwSecFileOperNotification alarm.";
}
else {    # unknown
    $Event->{'AlarmType'}  = 0;    # never auto-delete
    $Event->{'Summary'}    = "Unknown Trap Specific: $enterprise.$specific";
    $Event->{'AlarmGroup'} = 'UnknownTrap';
    $Event->{'Severity'}   = 1;    # unknown
    $Event->{'AlarmKey'}   = "Unknown Trap from [$ip]: $enterprise.$specific";

    $Event->{'Custom1'}    = $traplog;
}
