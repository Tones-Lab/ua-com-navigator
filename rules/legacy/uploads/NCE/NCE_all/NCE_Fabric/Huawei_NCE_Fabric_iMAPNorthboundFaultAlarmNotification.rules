# ------------------------------------------------------------------------------------------------------------- #
#
#
#
#  █████╗ ██╗   ██╗████████╗ ██████╗       ██████╗ ███████╗██████╗ ██╗      ██████╗ ██╗   ██╗███████╗██████╗ 
#  ██╔══██╗██║   ██║╚══██╔══╝██╔═══██╗      ██╔══██╗██╔════╝██╔══██╗██║     ██╔═══██╗╚██╗ ██╔╝██╔════╝██╔══██╗
#  ███████║██║   ██║   ██║   ██║   ██║█████╗██║  ██║█████╗  ██████╔╝██║     ██║   ██║ ╚████╔╝ █████╗  ██║  ██║
#  ██╔══██║██║   ██║   ██║   ██║   ██║╚════╝██║  ██║██╔══╝  ██╔═══╝ ██║     ██║   ██║  ╚██╔╝  ██╔══╝  ██║  ██║
#  ██║  ██║╚██████╔╝   ██║   ╚██████╔╝      ██████╔╝███████╗██║     ███████╗╚██████╔╝   ██║   ███████╗██████╔╝
#  ╚═╝  ╚═╝ ╚═════╝    ╚═╝    ╚═════╝       ╚═════╝ ╚══════╝╚═╝     ╚══════╝ ╚═════╝    ╚═╝   ╚══════╝╚═════╝ 
#  
#
#
#  Added by         D E P L O Y M E N T
#
#    Changes via the UI get's overwritten on the next deployment.
#
# ------------------------------------------------------------------------------------------------------------- #
##################################################################################################################
#       Desciption:     iMAPNorthboundFaultAlarmNotification notification traps:
#       OID:            .1.3.6.1.4.1.2011.2.15.2.4.3.3
#       Name:           iMAPNorthboundFaultAlarmNotification
#		Reference:		Netcool: Huawei_iMaster_NCE_iMAPNorthboundFaultAlarmNotification.rules
##################################################################################################################

my $rulesfile = "Huawei_NCE_Fabric_iMAPNorthboundFaultAlarmNotification.rules";
$Log->Message('DEBUG', "Executing: " . $rulesfile);
$Event->{SubMethod} = $rulesfile;

if (($specific == 1) or ($specific == 3)) {
    # case 1 - iMAPNorthboundFaultAlarmReportNotificationType
    # case 3 - iMAPNorthboundFaultAlarmQueryNotificationType	

    my $iMAPNorthboundAlarmCSN = $v1;
    my $iMAPNorthboundAlarmCategory = $v2;
    my $iMAPNorthboundAlarmOccurTime = $v3;
    my $iMAPNorthboundAlarmMOName = $v4;
    my $iMAPNorthboundAlarmProductID = $v5;
    my $iMAPNorthboundAlarmNEType = $v6;
    my $iMAPNorthboundAlarmNEDevID = $v7;
    my $iMAPNorthboundAlarmDevCsn = $v8;
    my $iMAPNorthboundAlarmID = $v9;
    my $iMAPNorthboundAlarmType = $v10;
    my $iMAPNorthboundAlarmLevel = $v11;
    my $iMAPNorthboundAlarmRestore = $v12;
    my $iMAPNorthboundAlarmConfirm = $v13;
    my $iMAPNorthboundAlarmAckTime = $v14;
    my $iMAPNorthboundAlarmRestoreTime = $v15;
    my $iMAPNorthboundAlarmOperator = $v16;
    my $iMAPNorthboundAlarmParas1 = $v17;
    my $iMAPNorthboundAlarmParas2 = $v18;
    my $iMAPNorthboundAlarmParas3 = $v19;
    my $iMAPNorthboundAlarmParas4 = $v20;
    my $iMAPNorthboundAlarmParas5 = $v21;
    my $iMAPNorthboundAlarmParas6 = $v22;
    my $iMAPNorthboundAlarmParas7 = $v23;
    my $iMAPNorthboundAlarmParas8 = $v24;
    my $iMAPNorthboundAlarmParas9 = $v25;
    my $iMAPNorthboundAlarmParas10 = $v26;
    my $iMAPNorthboundAlarmExtendInfo = $v27;
    my $iMAPNorthboundAlarmProbablecause = $v28;
    my $iMAPNorthboundAlarmProposedrepairactions = $v29;
    my $iMAPNorthboundAlarmSpecificproblems = $v30;
    my $iMAPNorthboundAlarmExtendProductItem1 = $v31;
    my $iMAPNorthboundAlarmExtendProductItem2 = $v32;
    my $iMAPNorthboundAlarmExtendProductItem3 = $v33;
    my $iMAPNorthboundAlarmExtendProductItem4 = $v34;
    my $iMAPNorthboundAlarmExtendProductItem5 = $v35;
    my $iMAPNorthboundAlarmExtendProductItem6 = $v36;
    my $iMAPNorthboundAlarmExtendProductItem7 = $v37;
    my $iMAPNorthboundAlarmExtendProductItem8 = $v38;
    my $iMAPNorthboundAlarmExtendProductItem9 = $v39;
    my $iMAPNorthboundAlarmExtendProductItem10 = $v40;
    my $iMAPNorthboundAlarmExtendProductItem11 = $v41;
    my $iMAPNorthboundAlarmExtendProductItem12 = $v42;
    my $iMAPNorthboundAlarmExtendProductItem13 = $v43;
    my $iMAPNorthboundAlarmExtendProductItem14 = $v44;
    my $iMAPNorthboundAlarmExtendProductItem15 = $v45;
    my $iMAPNorthboundAlarmClearOperator = $v46;
    my $iMAPNorthboundAlarmAdditionalInfo = $v47;
    my $iMAPNorthboundAlarmClearType = $v48;
    my $iMAPNorthboundAlarmClearCategory = $v49;
    my $iMAPNorthboundAlarmServiceAffectFlag = $v50;
    my $iMAPNorthboundAlarmObjectInstanceType = $v51;
    # I2000-V1::iMAPNorthboundFaultAlarmReportNotificationType

    $Event->{'Node'}					= $iMAPNorthboundAlarmMOName;
    $Event->{'NodeAlias'}				= $iMAPNorthboundAlarmMOName;
    $Event->{'AlarmCategorization2'}	= $iMAPNorthboundAlarmNEDevID;
    $Event->{'EventType'}				= $iMAPNorthboundAlarmNEDevID;
    $Event->{'SubNode'}					= $iMAPNorthboundAlarmID;
    $Event->{'DeviceType'}				= $iMAPNorthboundAlarmNEType;
    my $tmp_AlarmProductID = $huawei_iMaster_nce_lookup_iMAPNorthboundAlarmProductID{$iMAPNorthboundAlarmProductID};
    $Log->Message('DEBUG', "Temp Alarm Paroduct ID:". $tmp_AlarmProductID );
    if (defined $tmp_AlarmProductID)
    {
        $Log->Message('DEBUG', "Found Temp Alarm Paroduct ID");
        LibUtil_SetAdditionalInfo($Event,"ProductID", $tmp_AlarmProductID);
    }
    my $tmp_AlarmType = $huawei_iMaster_nce_lookup_iMAPNorthboundAlarmType{$iMAPNorthboundAlarmType};
    $Log->Message('DEBUG', "Temp Alarm Type:". $tmp_AlarmType );
    if (defined $tmp_AlarmType)
    {
        $Log->Message('DEBUG', "Found Temp Alarmtype found");
        LibUtil_SetAdditionalInfo($Event,"AlarmType", $tmp_AlarmType);
    }


    $Event->{'Summary'}					= $iMAPNorthboundAlarmParas2 . " - " .$iMAPNorthboundAlarmParas4 ;
    $Event->{'HelpKey'}	 				= $Event->{'HelpKey'} . " - " .  $iMAPNorthboundAlarmNEType . " - ". $iMAPNorthboundAlarmID;
    $Event->{'EMSAlarmID'}				= $iMAPNorthboundAlarmID;
    $Event->{AlarmCode} 				= $iMAPNorthboundAlarmCSN;

    LibUtil_SetAdditionalInfo($Event,"Details", $iMAPNorthboundAlarmParas10);

    if (exists $huawei_iMaster_nce_lookup_iMAPNorthboundFaultAlarmNotification_severities{$iMAPNorthboundAlarmCategory}) {
        $Event->{Severity}      = $huawei_iMaster_nce_lookup_iMAPNorthboundFaultAlarmNotification_severities{$iMAPNorthboundAlarmCategory}{Severity};
        $Event->{EventCategory} = $huawei_iMaster_nce_lookup_iMAPNorthboundFaultAlarmNotification_severities{$iMAPNorthboundAlarmCategory}{EventCategory};
    }    
    $Event->{'NEFirstReported'}	=Time::Piece->strptime($iMAPNorthboundAlarmOccurTime, "%Y/%m/%d - %H:%M:%SZ")->epoch;
    $Event->{'NELastReported'}=Time::Piece->strptime($iMAPNorthboundAlarmOccurTime, "%Y/%m/%d - %H:%M:%SZ")->epoch;
            
} elsif ($specific == 2) {
	# I2000-V2::iMAPNorthboundFaultAlarmQueryBeginNotificationType

    $Event->{'EventType'}				= "huawei";
    $Event->{'SubMethod'}     			= "huawei";
    $Event->{'Summary'}       			= "iMAPNorthboundFaultAlarmQueryBeginNotificationType: The iMAP notifies the NMS of the start of the query. After the NMS receives the active/current alarm query start trap, the query starts. The trap is triggered by NMS for alarm query.";
    $Event->{'EventCategory'} 			= 2;
    $Event->{'Severity'}      			= 3;
    $Event->{'SubDeviceType'} = 313;
} elsif ($specific == 4) {

	# I2000-V2::iMAPNorthboundFaultAlarmQueryEndNotificationType

    $Event->{'EventType'}				= "huawei";
    $Event->{'SubMethod'}     			= "huawei";
    $Event->{'Summary'}       			= "iMAPNorthboundFaultAlarmQueryEndNotificationType";
    $Event->{'EventCategory'} 			= 2;
    $Event->{'Severity'}      			= 3;
    $Event->{'SubDeviceType'} = 313;
}

$Log->Message('DEBUG', $rulesfile . " ...done");